<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NCA ECC-2:2024 Compliance Assessment Tool</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--navy:#0A2463;--blue:#1E6091;--green:#3A7D44;--orange:#E07A1B;--teal:#059669;--amber:#D97706;--red:#DC2626;--gray:#9CA3AF;--light:#F8F9FB;--dim-text:#B0B8C4;--dim-bg:#F2F3F5;--dark:#374151;--white:#fff}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:#f0f2f5;color:var(--dark)}
.app{display:flex;height:100vh;overflow:hidden}
.sidebar{width:270px;background:var(--navy);color:var(--white);overflow-y:auto;flex-shrink:0;display:flex;flex-direction:column}
.sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.1)}
.sidebar-header h1{font-size:14px;font-weight:700;letter-spacing:.5px;opacity:.9}
.sidebar-header h2{font-size:11px;font-weight:400;opacity:.5;margin-top:4px}
.nav-section{padding:8px 0}
.nav-domain{padding:10px 16px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;opacity:.5;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .2s}
.nav-domain:hover{opacity:.8;background:rgba(255,255,255,.05)}
.nav-domain.active{opacity:1;background:rgba(255,255,255,.1)}
.nav-domain .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.nav-sub{padding:7px 16px 7px 36px;font-size:12px;opacity:.6;cursor:pointer;transition:all .15s;border-left:2px solid transparent}
.nav-sub:hover{opacity:.9;background:rgba(255,255,255,.05)}
.nav-sub.active{opacity:1;background:rgba(255,255,255,.08);border-left-color:var(--teal)}
.nav-count{font-size:10px;opacity:.5;margin-left:auto;background:rgba(255,255,255,.1);padding:1px 6px;border-radius:8px}
.main{flex:1;overflow-y:auto;padding:0}
.topbar{position:sticky;top:0;z-index:100;background:var(--white);border-bottom:1px solid #e5e7eb;padding:12px 24px;display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.topbar h2{font-size:16px;color:var(--navy);font-weight:700;margin-right:auto}
.search-box{padding:7px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:13px;width:220px;outline:none}
.search-box:focus{border-color:var(--blue);box-shadow:0 0 0 2px rgba(30,96,145,.15)}
.tab-bar{display:flex;gap:0;background:var(--light);border-radius:8px;padding:3px}
.tab{padding:6px 14px;font-size:12px;font-weight:600;border-radius:6px;cursor:pointer;color:var(--dark);opacity:.6;transition:all .15s}
.tab:hover{opacity:.8}
.tab.active{background:var(--white);opacity:1;color:var(--navy);box-shadow:0 1px 3px rgba(0,0,0,.1)}
.domain-toggle{display:flex;gap:6px;padding:8px 24px;background:#f9fafb;border-bottom:1px solid #e5e7eb;flex-wrap:wrap;align-items:center}
.dtog{padding:5px 12px;border-radius:16px;font-size:11px;font-weight:600;cursor:pointer;border:2px solid transparent;transition:all .15s;opacity:.5}
.dtog.on{opacity:1;border-color:currentColor}
.dtog[data-d="1"]{color:var(--navy);background:#dbeafe}
.dtog[data-d="2"]{color:var(--blue);background:#dbeafe}
.dtog[data-d="3"]{color:var(--green);background:#d1fae5}
.dtog[data-d="4"]{color:var(--orange);background:#fef3c7}
.dtog.on[data-d="1"]{background:var(--navy);color:var(--white)}
.dtog.on[data-d="2"]{background:var(--blue);color:var(--white)}
.dtog.on[data-d="3"]{background:var(--green);color:var(--white)}
.dtog.on[data-d="4"]{background:var(--orange);color:var(--white)}
.content{padding:16px 24px 80px}
.domain-section{margin-bottom:24px}
.domain-header{padding:12px 18px;border-radius:8px 8px 0 0;color:var(--white);font-weight:700;font-size:14px;letter-spacing:.3px;display:flex;align-items:center;gap:10px}
.domain-header .badge{background:rgba(255,255,255,.2);padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600}
.sub-header{padding:8px 18px;font-size:12px;font-weight:600;border-left:3px solid;margin:12px 0 4px}
.ctrl-row{display:grid;grid-template-columns:80px 1fr 170px;background:var(--white);border:1px solid #e5e7eb;border-radius:6px;margin:4px 0;overflow:hidden;transition:all .3s}
.ctrl-row.dimmed{opacity:.5;background:var(--dim-bg)}
.ctrl-row.dimmed .ctrl-inputs textarea{background:var(--dim-bg);color:var(--dim-text);pointer-events:none}
.ctrl-row.hl-nc{border-left:3px solid var(--red)}
.ctrl-row.hl-pc{border-left:3px solid var(--amber)}
.ctrl-row.hl-c{border-left:3px solid var(--teal)}
.ctrl-row.hl-na{border-left:3px solid var(--gray)}
.ctrl-id{padding:10px;display:flex;align-items:flex-start;justify-content:center;font-weight:700;font-size:13px;color:var(--navy);background:var(--light);border-right:1px solid #e5e7eb}
.ctrl-body{padding:10px 14px;min-width:0}
.ctrl-summary{font-size:13px;font-weight:600;color:var(--dark);margin-bottom:2px}
.ctrl-detail{font-size:11px;color:#6b7280;line-height:1.5;max-height:0;overflow:hidden;transition:max-height .3s ease}
.ctrl-detail.open{max-height:300px;margin-top:4px}
.ctrl-expand{font-size:10px;color:var(--blue);cursor:pointer;font-weight:600;margin-top:4px;display:inline-block}
.ctrl-expand:hover{text-decoration:underline}
.ctrl-sub-label{font-size:10px;color:var(--dim-text);margin-top:4px}
.ctrl-status{padding:10px;display:flex;flex-direction:column;gap:6px;border-left:1px solid #e5e7eb;align-items:stretch}
select.ssel{padding:6px 8px;border:2px solid #d1d5db;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;background:var(--white);text-align:center;outline:none;width:100%}
select.ssel:focus{border-color:var(--blue)}
select.ssel.s-c{border-color:var(--teal);background:#d1fae5;color:var(--teal)}
select.ssel.s-pc{border-color:var(--amber);background:#fef3c7;color:#92400e}
select.ssel.s-nc{border-color:var(--red);background:#fee2e2;color:var(--red)}
select.ssel.s-na{border-color:var(--gray);background:#f3f4f6;color:var(--gray)}
.ctrl-inputs{grid-column:1/-1;padding:0 14px 10px;transition:all .2s}
.ctrl-inputs.hidden{display:none;padding:0}
.input-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.input-group label{font-size:10px;font-weight:600;color:var(--dim-text);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:2px}
.input-group textarea{width:100%;padding:6px 8px;border:1px solid #e5e7eb;border-radius:4px;font-size:12px;resize:vertical;min-height:36px;font-family:inherit;outline:none}
.input-group textarea:focus{border-color:var(--blue);box-shadow:0 0 0 2px rgba(30,96,145,.1)}
.input-group textarea.ev-input{border-color:var(--teal);background:#f0fff4}
.dash-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:24px}
.stat-card{background:var(--white);border-radius:10px;padding:20px;border:1px solid #e5e7eb;text-align:center}
.stat-card .val{font-size:28px;font-weight:800;color:var(--navy)}
.stat-card .lbl{font-size:12px;color:var(--dim-text);margin-top:4px;font-weight:600}
.stat-card.c-green .val{color:var(--teal)}
.stat-card.c-amber .val{color:var(--amber)}
.stat-card.c-red .val{color:var(--red)}
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.chart-card{background:var(--white);border-radius:10px;padding:20px;border:1px solid #e5e7eb}
.chart-card h3{font-size:14px;color:var(--navy);margin-bottom:16px;font-weight:700}
.bar-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.bar-label{width:160px;font-size:11px;font-weight:600;color:var(--dark);text-align:right;flex-shrink:0}
.bar-track{flex:1;height:24px;background:var(--light);border-radius:4px;overflow:hidden;display:flex}
.bar-seg{height:100%;transition:width .5s}
.bar-pct{width:50px;font-size:12px;font-weight:700;color:var(--navy);text-align:right}
.legend{display:flex;gap:14px;margin-top:14px;justify-content:center;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:5px;font-size:11px;font-weight:600}
.legend-dot{width:10px;height:10px;border-radius:2px}
.pring{position:relative;width:80px;height:80px;margin:0 auto 8px}
.pring svg{transform:rotate(-90deg)}
.pring .pv{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:800;color:var(--navy)}
.gap-table{width:100%;border-collapse:collapse;font-size:12px}
.gap-table th{background:var(--red);color:var(--white);padding:10px;text-align:left;font-size:11px;position:sticky;top:0}
.gap-table td{padding:8px 10px;border-bottom:1px solid #e5e7eb;vertical-align:top}
.gap-table tr:hover{background:#fef2f2}
.gap-nc{color:var(--red);font-weight:700}
.gap-pc{color:var(--amber);font-weight:700}
.gap-count{background:var(--red);color:var(--white);padding:2px 10px;border-radius:12px;font-size:12px;font-weight:700;margin-left:8px}
.empty-state{text-align:center;padding:60px 20px;color:var(--dim-text)}
.empty-state .icon{font-size:48px;margin-bottom:12px}
.empty-state h3{color:var(--dark);margin-bottom:8px}
.scard{background:var(--white);border-radius:10px;padding:24px;border:1px solid #e5e7eb;max-width:600px;margin-bottom:20px}
.scard h3{font-size:14px;color:var(--navy);margin-bottom:16px}
.sfield{margin-bottom:12px}
.sfield label{font-size:11px;font-weight:600;color:var(--dim-text);display:block;margin-bottom:4px}
.sfield input{width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:13px;outline:none}
.sfield input:focus{border-color:var(--blue)}
.btn{padding:8px 16px;border:none;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-p{background:var(--navy);color:var(--white)}.btn-p:hover{background:var(--blue)}
.btn-d{background:var(--red);color:var(--white)}.btn-d:hover{opacity:.9}
.btn-o{background:transparent;border:1px solid #d1d5db;color:var(--dark)}.btn-o:hover{background:var(--light)}
.act-bar{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}
@media(max-width:900px){.sidebar{width:220px}.input-row{grid-template-columns:1fr}.chart-row{grid-template-columns:1fr}}
@media(max-width:600px){.sidebar{display:none}.domain-toggle{overflow-x:auto;flex-wrap:nowrap}}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
// === ECC DATA ===
const ECC={
"1":{name:"Cybersecurity Governance",color:"#0A2463",subs:{
"1-1":{name:"Cybersecurity Strategy",obj:"Ensure action plans and objectives contribute to compliance with legislative and regulatory requirements.",c:[
["1-1-1","Cybersecurity strategy identified, documented, approved, and supported by entity head.","The cybersecurity strategy shall be identified, documented, and approved, supported by the head of the entity or delegate (Authorized Official). Goals shall align with legislative and regulatory requirements."],
["1-1-2","Action plan to apply cybersecurity strategy is executed.","The entity shall execute an action plan to apply the cybersecurity strategy."],
["1-1-3","Cybersecurity strategy reviewed at planned intervals.","The strategy shall be reviewed at planned intervals or when legislative/regulatory requirements change."]]},
"1-2":{name:"Cybersecurity Management",obj:"Ensure the Authorized Official supports implementation and management of cybersecurity programs.",c:[
["1-2-1","Independent cybersecurity department established, separate from IT.","A cybersecurity department shall be established independent from IT and Communications (per High Order No. 37140). It should report directly to entity head."],
["1-2-2","All cybersecurity positions filled with qualified Saudi professionals.","All cybersecurity positions shall be filled with full-time qualified Saudi cybersecurity professionals."],
["1-2-3","Cybersecurity supervisory committee established.","A supervisory committee shall be established to ensure compliance with and monitoring of cybersecurity programs. Members, responsibilities, and governance shall be documented."]]},
"1-3":{name:"Cybersecurity Policies and Procedures",obj:"Ensure cybersecurity requirements are documented and communicated.",c:[
["1-3-1","Policies and procedures documented, approved, and communicated.","The cybersecurity department shall identify, document, and approve policies and procedures, and communicate them to relevant personnel."],
["1-3-2","Policies and procedures implemented at the entity.","The cybersecurity department shall ensure policies and procedures are implemented."],
["1-3-3","Policies supported by technical security standards.","Policies shall be supported by technical security standards (e.g. for firewalls, databases, operating systems)."],
["1-3-4","Policies reviewed and updated at planned intervals.","Policies shall be reviewed and updated at planned intervals. Changes shall be documented and approved."]]},
"1-4":{name:"Cybersecurity Roles and Responsibilities",obj:"Ensure roles and responsibilities are clearly defined for all parties.",c:[
["1-4-1","Governance structure, roles, and responsibilities documented.","The Authorized Official shall identify, document, and approve the governance structure, roles, and responsibilities."],
["1-4-2","Roles and responsibilities reviewed at planned intervals.","Cybersecurity roles shall be reviewed and updated at planned intervals."]]},
"1-5":{name:"Cybersecurity Risk Management",obj:"Manage cybersecurity risks methodologically to protect assets.",c:[
["1-5-1","Risk management methodology documented and approved.","The cybersecurity department shall identify, document, and approve risk management methodology and procedures."],
["1-5-2","Risk management methodology implemented.","The methodology shall be implemented within the entity."],
["1-5-3","Risk assessments conducted at key stages.","Risk assessments shall be conducted at: (1) early project stages, (2) before major infrastructure changes, (3) when planning third-party services, (4) before releasing new services."],
["1-5-4","Risk management methodology reviewed and updated.","The methodology shall be reviewed at planned intervals. Changes documented and approved."]]},
"1-6":{name:"Cybersecurity in IT Project Management",obj:"Ensure cybersecurity requirements are included in project management.",c:[
["1-6-1","Cybersecurity included in project and change management.","Cybersecurity requirements shall be included in project management and change management methodologies."],
["1-6-2","Vulnerability assessment and secure config review before launch.","Requirements include: (1) vulnerability assessment, (2) secure configuration review before launching projects."],
["1-6-3","Secure software development requirements.","Requirements include: (1) secure coding standards, (2) trusted development tools, (3) compliance testing, (4) secure integration, (5) configuration review."],
["1-6-4","Project management cybersecurity requirements reviewed.","Cybersecurity requirements for project management shall be periodically reviewed."]]},
"1-7":{name:"Compliance with Standards, Laws & Regulations",obj:"Ensure compliance with relevant legislative and regulatory requirements.",c:[
["1-7-1","Comply with international agreements including cybersecurity.","The entity shall identify and comply with nationally approved international agreements that include cybersecurity requirements."]]},
"1-8":{name:"Periodical Review and Audit",obj:"Ensure controls are implemented in accordance with policies.",c:[
["1-8-1","Cybersecurity department periodically reviews controls.","The cybersecurity department shall periodically review implementation of controls."],
["1-8-2","Independent audit of controls (GAAS compliant).","Controls shall be audited by independent parties per Generally Accepted Auditing Standards."],
["1-8-3","Audit results documented and presented.","Results shall be documented and presented to the supervisory committee and Authorized Official."]]},
"1-9":{name:"Cybersecurity in Human Resources",obj:"Manage cybersecurity risks for personnel throughout employment lifecycle.",c:[
["1-9-1","Personnel requirements identified and approved.","Requirements for personnel shall be identified, documented, and approved for all employment phases."],
["1-9-2","Personnel cybersecurity requirements implemented.","Requirements for personnel shall be implemented."],
["1-9-3","Pre-employment screening and contract clauses.","Pre-employment: (1) cybersecurity clauses in contracts, (2) screening for cybersecurity and critical positions."],
["1-9-4","Awareness and compliance during employment.","During employment: (1) cybersecurity awareness, (2) compliance with policies and procedures."],
["1-9-5","Powers revoked upon employment end.","Personnel powers shall be reviewed and revoked immediately upon employment end."],
["1-9-6","Personnel requirements periodically reviewed.","Requirements for personnel shall be periodically reviewed."]]},
"1-10":{name:"Cybersecurity Awareness & Training",obj:"Ensure personnel have required awareness and training.",c:[
["1-10-1","Awareness program developed and approved.","An awareness program shall be developed through multiple channels to strengthen cybersecurity awareness."],
["1-10-2","Awareness program implemented.","The program shall be implemented within the entity."],
["1-10-3","Program covers key cyber threats.","Program covers: (1) phishing, (2) mobile devices, (3) Internet browsing, (4) social media."],
["1-10-4","Specialized training for cybersecurity personnel.","Training for: (1) cybersecurity staff, (2) IT/dev staff, (3) executive positions."],
["1-10-5","Awareness program implementation reviewed.","Implementation shall be periodically reviewed."]]}}},
"2":{name:"Cybersecurity Defense",color:"#1E6091",subs:{
"2-1":{name:"Asset Management",obj:"Ensure accurate and updated inventory of all assets.",c:[
["2-1-1","Asset management requirements identified and approved.","Requirements for managing information and technology assets shall be identified, documented, and approved."],
["2-1-2","Asset management requirements implemented.","Requirements shall be implemented."],
["2-1-3","Acceptable use policy documented and communicated.","Acceptable use policy shall be identified, documented, approved, and communicated."],
["2-1-4","Acceptable use policy implemented.","Acceptable use policy shall be implemented."],
["2-1-5","Assets classified, labeled, and handled.","Assets shall be classified, labeled, and handled per legislative requirements."],
["2-1-6","Asset management requirements reviewed.","Requirements shall be periodically reviewed."]]},
"2-2":{name:"Identity and Access Management",obj:"Protect logical access and prevent unauthorized access.",c:[
["2-2-1","IAM requirements identified and approved.","IAM requirements shall be identified, documented, and approved."],
["2-2-2","IAM requirements implemented.","IAM requirements shall be implemented."],
["2-2-3","IAM controls include MFA, least privilege, PAM.","Includes: (1) single-factor auth, (2) MFA for remote/privileged, (3) Need-to-Know/Least Privilege/SoD, (4) PAM, (5) periodic review."],
["2-2-4","IAM implementation reviewed.","Implementation shall be periodically reviewed."]]},
"2-3":{name:"Information Systems & Facilities Protection",obj:"Protect systems and facilities against cyber risks.",c:[
["2-3-1","System protection requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-3-2","System protection requirements implemented.","Requirements shall be implemented."],
["2-3-3","Malware defense, patch management, clock sync.","Includes: (1) malware protection, (2) storage media restriction, (3) patch management, (4) clock synchronization."],
["2-3-4","System protection reviewed.","Implementation shall be periodically reviewed."]]},
"2-4":{name:"Email Protection",obj:"Protect email service against cyber risks.",c:[
["2-4-1","Email protection requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-4-2","Email protection requirements implemented.","Requirements shall be implemented."],
["2-4-3","Anti-phishing, MFA, APT, SPF/DKIM/DMARC.","Includes: (1) advanced filtering, (2) MFA for webmail, (3) archiving, (4) APT protection, (5) SPF/DKIM/DMARC."],
["2-4-4","Email protection reviewed.","Implementation shall be periodically reviewed."]]},
"2-5":{name:"Network Security Management",obj:"Protect networks against cyber risks.",c:[
["2-5-1","Network security requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-5-2","Network security requirements implemented.","Requirements shall be implemented."],
["2-5-3","Segmentation, IPS, DNS, DDoS, APT protection.","Includes: (1) firewall/defense-in-depth, (2) env isolation, (3) secure browsing, (4) wireless security, (5) port restriction, (6) IPS, (7) DNS security, (8) APT, (9) DDoS protection."],
["2-5-4","Network security reviewed.","Implementation shall be periodically reviewed."]]},
"2-6":{name:"Mobile Devices Security",obj:"Protect mobile devices and BYOD.",c:[
["2-6-1","Mobile/BYOD requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-6-2","Mobile/BYOD requirements implemented.","Requirements shall be implemented."],
["2-6-3","Encryption, restricted use, remote wipe.","Includes: (1) data separation/encryption, (2) controlled use, (3) data deletion on loss, (4) awareness."],
["2-6-4","Mobile/BYOD security reviewed.","Implementation shall be periodically reviewed."]]},
"2-7":{name:"Data and Information Protection",obj:"Ensure confidentiality, integrity, and availability of data.",c:[
["2-7-1","Data protection requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-7-2","Data protection implemented based on classification.","Requirements shall be implemented based on classification level."],
["2-7-3","Data protection reviewed.","Implementation shall be periodically reviewed."]]},
"2-8":{name:"Cryptography",obj:"Ensure proper use of cryptography to protect assets.",c:[
["2-8-1","Cryptography requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-8-2","Cryptography requirements implemented.","Requirements shall be implemented."],
["2-8-3","NCA Cryptographic Standards, key management, encryption.","Includes: (1) NCA approved standards, (2) secure key management, (3) encryption in-transit and at-rest."],
["2-8-4","Cryptography implementation reviewed.","Implementation shall be periodically reviewed."]]},
"2-9":{name:"Backup and Recovery Management",obj:"Protect data and configurations against cyber risks.",c:[
["2-9-1","Backup/recovery requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-9-2","Backup/recovery requirements implemented.","Requirements shall be implemented."],
["2-9-3","Critical asset coverage, quick recovery, periodic testing.","Includes: (1) critical asset backup coverage, (2) quick recovery capability, (3) periodic testing."],
["2-9-4","Backup/recovery reviewed.","Implementation shall be periodically reviewed."]]},
"2-10":{name:"Vulnerability Management",obj:"Ensure timely detection and remediation of vulnerabilities.",c:[
["2-10-1","Vulnerability management requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-10-2","Vulnerability management requirements implemented.","Requirements shall be implemented."],
["2-10-3","Periodic assessment, classification, remediation, patching.","Includes: (1) periodic assessment, (2) severity classification, (3) risk-based remediation, (4) patch management, (5) trusted resources."],
["2-10-4","Vulnerability management reviewed.","Implementation shall be periodically reviewed."]]},
"2-11":{name:"Penetration Testing",obj:"Assess defense capabilities through simulated attacks.",c:[
["2-11-1","Penetration testing requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-11-2","Penetration testing requirements implemented.","Requirements shall be implemented."],
["2-11-3","All external services tested periodically.","Includes: (1) scope covering all external services, (2) periodic testing."],
["2-11-4","Penetration testing reviewed.","Implementation shall be periodically reviewed."]]},
"2-12":{name:"Event Logs and Monitoring",obj:"Ensure timely collection and monitoring of event logs.",c:[
["2-12-1","Event log/monitoring requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-12-2","Event log/monitoring requirements implemented.","Requirements shall be implemented."],
["2-12-3","SIEM, critical asset logs, 12-month retention.","Includes: (1) critical asset logs, (2) privileged account logs, (3) SIEM, (4) continuous monitoring, (5) 12-month retention."],
["2-12-4","Event log/monitoring reviewed.","Implementation shall be periodically reviewed."]]},
"2-13":{name:"Incident and Threat Management",obj:"Ensure timely identification and management of incidents.",c:[
["2-13-1","Incident/threat management requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-13-2","Incident/threat management requirements implemented.","Requirements shall be implemented."],
["2-13-3","Response plans, NCA reporting, threat intelligence.","Includes: (1) response plans, (2) classification, (3) NCA reporting, (4) threat intelligence sharing, (5) threat feeds."],
["2-13-4","Incident/threat management reviewed.","Implementation shall be periodically reviewed."]]},
"2-14":{name:"Physical Security",obj:"Protect assets against unauthorized physical access.",c:[
["2-14-1","Physical security requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-14-2","Physical security requirements implemented.","Requirements shall be implemented."],
["2-14-3","Critical area access, CCTV, secure destruction.","Includes: (1) authorized access to critical areas, (2) CCTV, (3) log protection, (4) secure destruction, (5) device security."],
["2-14-4","Physical security reviewed.","Implementation shall be periodically reviewed."]]},
"2-15":{name:"Web Application Security",obj:"Protect external web applications against cyber risks.",c:[
["2-15-1","Web app security requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["2-15-2","Web app security requirements implemented.","Requirements shall be implemented."],
["2-15-3","WAF, multi-tier, HTTPS, user authentication.","Includes: (1) WAF, (2) multi-tier architecture, (3) HTTPS, (4) secure usage policy, (5) user authentication."],
["2-15-4","Web app security reviewed.","Implementation shall be periodically reviewed."]]}}},
"3":{name:"Cybersecurity Resilience",color:"#3A7D44",subs:{
"3-1":{name:"BCM Cybersecurity Resilience",obj:"Ensure resilience requirements are included in BCM.",c:[
["3-1-1","BCM cybersecurity requirements identified and approved.","Requirements for business continuity management shall be identified, documented, and approved."],
["3-1-2","BCM cybersecurity requirements implemented.","Requirements shall be implemented."],
["3-1-3","Continuity, incident response, disaster recovery plans.","Includes: (1) continuity of cybersecurity systems, (2) incident response plans for business continuity, (3) disaster recovery plans."],
["3-1-4","BCM cybersecurity requirements reviewed.","Requirements shall be periodically reviewed."]]}}},
"4":{name:"Third-Party & Cloud Cybersecurity",color:"#E07A1B",subs:{
"4-1":{name:"Third-Party Cybersecurity",obj:"Protect assets against third-party cybersecurity risks.",c:[
["4-1-1","Third-party contract requirements identified and approved.","Requirements for contracts with third parties shall be identified, documented, and approved."],
["4-1-2","Contract clauses: NDA, incident procedures, compliance.","Contracts shall include: (1) NDA and data removal, (2) incident communication, (3) third-party compliance obligation."],
["4-1-3","Outsourcing: risk assessment, managed services in KSA.","Outsourcing includes: (1) risk assessment before contracts, (2) managed service centers located in KSA."],
["4-1-4","Third-party requirements reviewed.","Requirements shall be periodically reviewed."]]},
"4-2":{name:"Cloud Computing & Hosting Cybersecurity",obj:"Ensure cybersecurity for cloud and hosting services.",c:[
["4-2-1","Cloud/hosting requirements identified and approved.","Requirements shall be identified, documented, and approved."],
["4-2-2","Cloud/hosting requirements implemented.","Requirements shall be implemented."],
["4-2-3","Data protection, return, environment separation.","Includes: (1) data protection per classification and return in usable format, (2) environment separation from other entities."],
["4-2-4","Cloud/hosting requirements reviewed.","Requirements shall be periodically reviewed."]]}}}
};

// === STATE ===
let S=JSON.parse(localStorage.getItem('ecc_v6')||'{}');
if(!S.ctrls)S={ctrls:{},cfg:{entity:'',assessor:'',date:''},doms:{'1':true,'2':true,'3':true,'4':true}};
let tab='assessment',search='',navSub=null;

const sv=()=>localStorage.setItem('ecc_v6',JSON.stringify(S));
const gc=id=>{if(!S.ctrls[id])S.ctrls[id]={s:'',e:'',n:'',r:''};return S.ctrls[id]};
const allC=()=>{let a=[];for(let d in ECC)for(let s in ECC[d].subs)a.push(...ECC[d].subs[s].c);return a};
const cnt=(arr,st)=>arr.filter(x=>gc(x[0]).s===st).length;

function findSub(cid){
  const sid=cid.substring(0,cid.lastIndexOf('-'));
  for(let d in ECC)for(let s in ECC[d].subs)if(s===sid)return{sid:s,name:ECC[d].subs[s].name};
  return{sid:'',name:''};
}

// === RENDER ===
function render(){
const $=document.getElementById('app');
const all=allC();
const comp=cnt(all,'Compliant'),pc=cnt(all,'Partially Compliant'),nc=cnt(all,'Non-Compliant'),na=cnt(all,'Not Applicable');
const assessed=comp+pc+nc+na;
const rate=(comp+pc+nc)>0?Math.round(comp/(comp+pc+nc)*100):0;

$.innerHTML=`
<div class="sidebar">
 <div class="sidebar-header"><h1>NCA ECC-2:2024</h1><h2>Compliance Assessment</h2></div>
 <div class="nav-section">
  ${Object.entries(ECC).map(([did,d])=>`
   <div class="nav-domain ${S.doms[did]?'active':''}" onclick="tglDom('${did}')"><span class="dot" style="background:${d.color}"></span>${d.name}</div>
   ${S.doms[did]?Object.entries(d.subs).map(([sid,s])=>{
     const tot=s.c.length,done=s.c.filter(x=>gc(x[0]).s!=='').length;
     return`<div class="nav-sub ${navSub===sid?'active':''}" onclick="goSub('${sid}')">${sid} ${s.name}<span class="nav-count">${done}/${tot}</span></div>`;
   }).join(''):''}
  `).join('')}
 </div>
</div>
<div class="main">
 <div class="topbar">
  <h2>${tab==='assessment'?'Assessment':tab==='dashboard'?'Dashboard':tab==='gaps'?'Gap Analysis':'Settings'}</h2>
  ${tab==='assessment'?`<input class="search-box" placeholder="Search controls..." value="${search}" oninput="search=this.value;render()"/>`:''}
  <div class="tab-bar">
   <div class="tab ${tab==='dashboard'?'active':''}" onclick="tab='dashboard';render()">Dashboard</div>
   <div class="tab ${tab==='assessment'?'active':''}" onclick="tab='assessment';render()">Assessment</div>
   <div class="tab ${tab==='gaps'?'active':''}" onclick="tab='gaps';render()">Gaps <span class="gap-count">${nc+pc}</span></div>
   <div class="tab ${tab==='settings'?'active':''}" onclick="tab='settings';render()">Settings</div>
  </div>
 </div>
 ${tab==='assessment'?`<div class="domain-toggle"><span style="font-size:11px;font-weight:600;color:#6b7280;margin-right:4px">Filter:</span>${Object.entries(ECC).map(([did,d])=>`<div class="dtog ${S.doms[did]?'on':''}" data-d="${did}" onclick="tglDom('${did}')">${d.name}</div>`).join('')}</div>`:''}
 <div class="content">${
  tab==='dashboard'?rDash(all,assessed,comp,pc,nc,na,rate):
  tab==='assessment'?rAss():
  tab==='gaps'?rGaps(all):rSet()
 }</div>
</div>`;
}

function rDash(all,assessed,comp,pc,nc,na,rate){
const ds=Object.entries(ECC).map(([did,d])=>{
 const arr=[];for(let s in d.subs)arr.push(...d.subs[s].c);
 const c=cnt(arr,'Compliant'),p=cnt(arr,'Partially Compliant'),n=cnt(arr,'Non-Compliant'),a=cnt(arr,'Not Applicable');
 return{name:d.name,color:d.color,tot:arr.length,c,p,n,a,rate:(c+p+n)>0?Math.round(c/(c+p+n)*100):0};
});
return`
<div class="dash-grid">
 <div class="stat-card"><div class="pring"><svg width="80" height="80"><circle cx="40" cy="40" r="34" fill="none" stroke="#e5e7eb" stroke-width="6"/><circle cx="40" cy="40" r="34" fill="none" stroke="#059669" stroke-width="6" stroke-dasharray="${rate*2.136} 213.6" stroke-linecap="round"/></svg><div class="pv">${rate}%</div></div><div class="lbl">Compliance Rate</div></div>
 <div class="stat-card"><div class="val">${assessed}/${all.length}</div><div class="lbl">Controls Assessed</div></div>
 <div class="stat-card c-green"><div class="val">${comp}</div><div class="lbl">Compliant</div></div>
 <div class="stat-card c-amber"><div class="val">${pc}</div><div class="lbl">Partially Compliant</div></div>
 <div class="stat-card c-red"><div class="val">${nc}</div><div class="lbl">Non-Compliant</div></div>
</div>
<div class="chart-row">
 <div class="chart-card"><h3>Domain Compliance Breakdown</h3>
  ${ds.map(d=>`<div class="bar-row"><div class="bar-label">${d.name}</div><div class="bar-track">
   <div class="bar-seg" style="width:${d.tot?d.c/d.tot*100:0}%;background:#059669"></div>
   <div class="bar-seg" style="width:${d.tot?d.p/d.tot*100:0}%;background:#D97706"></div>
   <div class="bar-seg" style="width:${d.tot?d.n/d.tot*100:0}%;background:#DC2626"></div>
   <div class="bar-seg" style="width:${d.tot?d.a/d.tot*100:0}%;background:#9CA3AF"></div>
  </div><div class="bar-pct">${d.rate}%</div></div>`).join('')}
  <div class="legend">
   <div class="legend-item"><div class="legend-dot" style="background:#059669"></div>Compliant</div>
   <div class="legend-item"><div class="legend-dot" style="background:#D97706"></div>Partially Compliant</div>
   <div class="legend-item"><div class="legend-dot" style="background:#DC2626"></div>Non-Compliant</div>
   <div class="legend-item"><div class="legend-dot" style="background:#9CA3AF"></div>Not Applicable</div>
  </div>
 </div>
 <div class="chart-card"><h3>Compliance Rate by Domain</h3>
  ${ds.map(d=>`<div class="bar-row"><div class="bar-label">${d.name}</div><div class="bar-track">
   <div class="bar-seg" style="width:${d.rate}%;background:${d.color}"></div>
  </div><div class="bar-pct">${d.rate}%</div></div>`).join('')}
 </div>
</div>`;
}

function rAss(){
const q=search.toLowerCase();
let html='';
for(const[did,dom]of Object.entries(ECC)){
 if(!S.doms[did])continue;
 let dh='',vis=false;
 for(const[sid,sub]of Object.entries(dom.subs)){
  const fc=sub.c.filter(x=>!q||x[0].toLowerCase().includes(q)||x[1].toLowerCase().includes(q)||x[2].toLowerCase().includes(q));
  if(!fc.length)continue;
  vis=true;
  dh+=`<div class="sub-header" id="sub-${sid}" style="border-color:${dom.color};color:${dom.color}">${sid} ${sub.name} — <span style="font-weight:400;font-size:11px;color:#6b7280">${sub.obj}</span></div>`;
  fc.forEach(([id,sum,det])=>{
   const ct=gc(id);
   const dim=ct.s==='Compliant'||ct.s==='Not Applicable';
   const hl=ct.s==='Compliant'?'hl-c':ct.s==='Partially Compliant'?'hl-pc':ct.s==='Non-Compliant'?'hl-nc':ct.s==='Not Applicable'?'hl-na':'';
   const sc=ct.s==='Compliant'?'s-c':ct.s==='Partially Compliant'?'s-pc':ct.s==='Non-Compliant'?'s-nc':ct.s==='Not Applicable'?'s-na':'';
   dh+=`<div class="ctrl-row ${dim?'dimmed':''} ${hl}">
    <div class="ctrl-id">${id}</div>
    <div class="ctrl-body">
     <div class="ctrl-summary">${sum}</div>
     <div class="ctrl-detail" id="dt-${id}">${det}</div>
     <span class="ctrl-expand" onclick="let e=document.getElementById('dt-${id}');e.classList.toggle('open');this.textContent=e.classList.contains('open')?'Hide details':'Show details'">Show details</span>
     <div class="ctrl-sub-label">${sid} ${sub.name}</div>
    </div>
    <div class="ctrl-status">
     <select class="ssel ${sc}" onchange="setSt('${id}',this.value)">
      <option value="">— Select —</option>
      <option value="Compliant"${ct.s==='Compliant'?' selected':''}>Compliant</option>
      <option value="Partially Compliant"${ct.s==='Partially Compliant'?' selected':''}>Partially Compliant</option>
      <option value="Non-Compliant"${ct.s==='Non-Compliant'?' selected':''}>Non-Compliant</option>
      <option value="Not Applicable"${ct.s==='Not Applicable'?' selected':''}>Not Applicable</option>
     </select>
    </div>
    <div class="ctrl-inputs ${dim?'hidden':''}">
     <div class="input-row">
      <div class="input-group"><label>Evidence / Artifacts</label><textarea class="ev-input" placeholder="Document evidence..." onchange="setF('${id}','e',this.value)">${ct.e||''}</textarea></div>
      <div class="input-group"><label>Assessment Notes</label><textarea placeholder="Notes..." onchange="setF('${id}','n',this.value)">${ct.n||''}</textarea></div>
      <div class="input-group"><label>Remediation Action</label><textarea placeholder="Remediation plan..." onchange="setF('${id}','r',this.value)">${ct.r||''}</textarea></div>
     </div>
    </div>
   </div>`;
  });
 }
 if(vis){
  const arr=[];for(let s in dom.subs)arr.push(...dom.subs[s].c);
  const done=arr.filter(x=>gc(x[0]).s!=='').length;
  html+=`<div class="domain-section"><div class="domain-header" style="background:${dom.color}">Domain ${did}: ${dom.name} <span class="badge">${done}/${arr.length} assessed</span></div>${dh}</div>`;
 }
}
return html||'<div class="empty-state"><div class="icon">&#128269;</div><h3>No controls found</h3><p>Adjust your search or domain filters.</p></div>';
}

function rGaps(all){
const gaps=all.filter(x=>{const s=gc(x[0]).s;return s==='Non-Compliant'||s==='Partially Compliant';});
if(!gaps.length)return'<div class="empty-state"><div class="icon">&#9989;</div><h3>No Gaps Found</h3><p>All assessed controls are Compliant or Not Applicable.</p></div>';
gaps.sort((a,b)=>{const sa=gc(a[0]).s,sb=gc(b[0]).s;return sa==='Non-Compliant'&&sb!=='Non-Compliant'?-1:sb==='Non-Compliant'&&sa!=='Non-Compliant'?1:0;});
return`<table class="gap-table"><thead><tr><th>#</th><th>Control ID</th><th>Subdomain</th><th>Control</th><th>Status</th><th>Evidence / Notes</th><th>Remediation</th></tr></thead><tbody>
${gaps.map((x,i)=>{
 const ct=gc(x[0]),info=findSub(x[0]);
 return`<tr><td>${i+1}</td><td><strong>${x[0]}</strong></td><td>${info.sid} ${info.name}</td><td>${x[1]}</td><td class="${ct.s==='Non-Compliant'?'gap-nc':'gap-pc'}">${ct.s}</td><td>${ct.e||ct.n||'<em style="color:#9ca3af">—</em>'}</td><td>${ct.r||'<em style="color:#9ca3af">—</em>'}</td></tr>`;
}).join('')}</tbody></table>`;
}

function rSet(){
return`
<div class="scard"><h3>Entity Information</h3>
 <div class="sfield"><label>Entity Name</label><input value="${S.cfg.entity||''}" onchange="S.cfg.entity=this.value;sv()"/></div>
 <div class="sfield"><label>Assessor Name</label><input value="${S.cfg.assessor||''}" onchange="S.cfg.assessor=this.value;sv()"/></div>
 <div class="sfield"><label>Assessment Date</label><input type="date" value="${S.cfg.date||''}" onchange="S.cfg.date=this.value;sv()"/></div>
</div>
<div class="scard"><h3>Export & Data</h3>
 <div class="act-bar">
  <button class="btn btn-p" onclick="expCSV()">Export CSV</button>
  <button class="btn btn-o" onclick="expJSON()">Export JSON</button>
  <button class="btn btn-d" onclick="if(confirm('Reset ALL data? Cannot be undone.')){S={ctrls:{},cfg:{entity:'',assessor:'',date:''},doms:{'1':true,'2':true,'3':true,'4':true}};sv();render()}">Reset All</button>
 </div>
</div>
<div class="scard"><h3>About</h3><p style="font-size:13px;line-height:1.6;color:#6b7280">NCA ECC-2:2024 Assessment Tool. 4 domains, 28 subdomains, 108 controls. Data saved in browser localStorage.</p></div>`;
}

// === ACTIONS ===
function setSt(id,v){gc(id).s=v;sv();render()}
function setF(id,f,v){gc(id)[f]=v;sv()}
function tglDom(d){S.doms[d]=!S.doms[d];sv();render()}
function goSub(sid){navSub=sid;tab='assessment';render();setTimeout(()=>{const e=document.getElementById('sub-'+sid);if(e)e.scrollIntoView({behavior:'smooth',block:'start'})},50)}

function expCSV(){
let csv='Control ID,Domain,Subdomain,Control,Description,Status,Evidence,Notes,Remediation\n';
for(const[did,d]of Object.entries(ECC))for(const[sid,s]of Object.entries(d.subs))for(const[id,sum,det]of s.c){
 const c=gc(id);
 csv+=`"${id}","Domain ${did}: ${d.name}","${sid} ${s.name}","${sum.replace(/"/g,'""')}","${det.replace(/"/g,'""')}","${c.s}","${(c.e||'').replace(/"/g,'""')}","${(c.n||'').replace(/"/g,'""')}","${(c.r||'').replace(/"/g,'""')}"\n`;
}
const b=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='NCA_ECC_2024_Assessment.csv';a.click();
}
function expJSON(){
const data={settings:S.cfg,exported:new Date().toISOString(),controls:{}};
for(const[did,d]of Object.entries(ECC))for(const[sid,s]of Object.entries(d.subs))for(const[id,sum,det]of s.c){
 const c=gc(id);data.controls[id]={domain:`Domain ${did}: ${d.name}`,subdomain:`${sid} ${s.name}`,control:sum,description:det,status:c.s,evidence:c.e,notes:c.n,remediation:c.r};
}
const b=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='NCA_ECC_2024_Assessment.json';a.click();
}

render();
</script>
</body>
</html>
